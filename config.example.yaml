# Morpheus Configuration
# Copy this file to config.yaml or ~/.morpheus/config.yaml

# ─────────────────────────────────────────────────────────────────────────────
# Machine Provider Configuration
# ─────────────────────────────────────────────────────────────────────────────
machine:
  provider: hetzner  # "hetzner", "local", or "none"
  
  # Hetzner-specific settings (used when provider is "hetzner")
  hetzner:
    server_type: cx22      # Server type
    server_type_fallback:  # Fallback server types if primary unavailable
      - cpx11
      - cx32
    image: ubuntu-24.04    # OS image
    location: fsn1         # Datacenter location
  
  # SSH key configuration
  ssh:
    key_name: morpheus  # Name for the SSH key (will be auto-uploaded to Hetzner)
    key_path: ""        # Optional: Path to your SSH public key (e.g., ~/.ssh/id_ed25519.pub)
                        # If not specified, Morpheus will search common locations
  
  # Azure-specific settings (used by morpheus-azureguard only)
  azure:
    subscription_id: ""        # Or ${AZURE_SUBSCRIPTION_ID}
    tenant_id: ""              # Or ${AZURE_TENANT_ID}
    client_id: ""              # Or ${AZURE_CLIENT_ID}
    client_secret: ""          # Or ${AZURE_CLIENT_SECRET}
    resource_group: morpheus-guards
    location: westeurope
    vm_size: Standard_B1s
    image: "Canonical:0001-com-ubuntu-server-jammy:22_04-lts:latest"

  # IPv4 configuration
  ipv4:
    enabled: false  # Enable IPv4 (costs extra on Hetzner, use if no IPv6)

# ─────────────────────────────────────────────────────────────────────────────
# Guard Configuration (morpheus-azureguard)
# ─────────────────────────────────────────────────────────────────────────────
guard:
  vnet_cidr: "10.100.0.0/16"      # Guard VNet address space
  subnet_cidr: "10.100.1.0/24"    # Guard VM subnet
  wg_port: 51820                   # WireGuard listen port

# ─────────────────────────────────────────────────────────────────────────────
# DNS Provider Configuration (optional)
# ─────────────────────────────────────────────────────────────────────────────
dns:
  provider: none       # "hetzner", "hosts", or "none"
  domain: ""           # Base domain for DNS records (e.g., morpheus.example.com)
  ttl: 300             # TTL for DNS records in seconds

# ─────────────────────────────────────────────────────────────────────────────
# Storage Provider Configuration
# ─────────────────────────────────────────────────────────────────────────────
storage:
  provider: local  # "storagebox", "local", or "none"
  
  # StorageBox settings (for Hetzner StorageBox via WebDAV)
  storagebox:
    host: ""           # uXXXXX.your-storagebox.de
    username: ""       # uXXXXX
    password: ""       # Or use ${STORAGEBOX_PASSWORD} env var
  
  # Local storage settings
  local:
    path: ""           # Default: ~/.morpheus/registry.json

# ─────────────────────────────────────────────────────────────────────────────
# Provisioning Settings
# ─────────────────────────────────────────────────────────────────────────────
provisioning:
  readiness_timeout: "5m"  # How long to wait for servers to be ready
  readiness_interval: "5s" # How often to check server readiness
  ssh_port: 22             # SSH port for connectivity checks

# ─────────────────────────────────────────────────────────────────────────────
# API Tokens and Secrets
# ─────────────────────────────────────────────────────────────────────────────
secrets:
  hetzner_api_token: ""   # Or set via HETZNER_API_TOKEN env var (used for both Cloud and DNS)

# ─────────────────────────────────────────────────────────────────────────────
# Legacy Configuration (for backward compatibility)
# ─────────────────────────────────────────────────────────────────────────────
# The following sections are supported for backward compatibility
# but it's recommended to use the new format above.

# infrastructure:
#   provider: hetzner
#   ssh:
#     key_name: morpheus
#   enable_ipv4_fallback: false

# integration:
#   nimsforest_url: ""
#   # NimsForest is installed by default on all provisioned machines
#   # Set to false to disable auto-installation
#   nimsforest_install: true
#   # Download URL for NimsForest binary (defaults to latest GitHub release)
#   nimsforest_download_url: "https://github.com/nimsforest/nimsforest2/releases/latest/download/forest-linux-amd64"

# registry:
#   type: local
#   url: ""
#   username: ""
#   password: ""
#   storagebox_host: ""

# ─────────────────────────────────────────────────────────────────────────────
# ℹ️  Quick Start
# ─────────────────────────────────────────────────────────────────────────────
#
# 1. Get your Hetzner API token:
#    https://console.hetzner.cloud/ → Security → API Tokens
#
# 2. Set your token:
#    export HETZNER_API_TOKEN="your-token-here"
#
# 3. Create a forest:
#    morpheus plant                # Create 1-node forest
#    morpheus plant --nodes 3      # Create 3-node forest
#
# 4. Check your forests:
#    morpheus list
#    morpheus status <forest-id>
#
# 5. Clean up:
#    morpheus teardown <forest-id>
#
# ─────────────────────────────────────────────────────────────────────────────
# ℹ️  Configuration Notes
# ─────────────────────────────────────────────────────────────────────────────
#
# SSH Keys:
#   - Morpheus will automatically upload your SSH key to Hetzner if needed
#   - Default search locations: ~/.ssh/id_ed25519.pub, ~/.ssh/id_rsa.pub
#   - You can specify a custom key_path if your key is in a different location
#
# IPv6/IPv4:
#   - All machines use IPv6 by default (IPv4 costs extra on Hetzner)
#   - If your network lacks IPv6, set machine.ipv4.enabled: true
#   - Test connectivity with: morpheus check network
#
# DNS (optional):
#   - Configure DNS to automatically create records for your servers
#   - Supports Hetzner DNS or custom hosts file
#   - Records: <forest-id>-node-<n>.<domain> → server IP
#
# Cost Estimates:
#   - 1 node:  ≈ €3-4/month   (perfect for testing)
#   - 3 nodes: ≈ €9-12/month  (small production)
#   - 5 nodes: ≈ €15-20/month (larger deployment)
#   - Billed by the minute, can teardown anytime
#
# ─────────────────────────────────────────────────────────────────────────────
