# Morpheus Configuration
# Copy this file to config.yaml or ~/.morpheus/config.yaml

# Infrastructure provider
infrastructure:
  provider: hetzner  # Currently only 'hetzner' and 'local' are supported
  
  # SSH key configuration
  ssh:
    key_name: morpheus  # Name for the SSH key (will be auto-uploaded to Hetzner)
    key_path: ""        # Optional: Path to your SSH public key (e.g., ~/.ssh/id_ed25519.pub)
                        # If not specified, Morpheus will search common locations
  
  # IPv4 fallback (default: false)
  # Enable this if your network doesn't have IPv6 connectivity
  # Note: IPv4 costs extra on Hetzner Cloud
  enable_ipv4_fallback: false

# Integration with NimsForest
integration:
  nimsforest_url: ""  # URL for NimsForest callbacks (optional)
  registry_url: ""    # Morpheus registry URL (optional)
  
  # Auto-install NimsForest on provisioned machines
  nimsforest_install: true                              # Download and start NimsForest automatically
  nimsforest_download_url: "https://nimsforest.io/bin/nimsforest"  # URL to download binary

# Provisioning settings
provisioning:
  readiness_timeout: "5m"  # How long to wait for servers to be ready
  readiness_interval: "5s" # How often to check server readiness (default: 5s)
  ssh_port: 22             # SSH port for connectivity checks

# Registry for multi-device forest management
# Use "storagebox" for Hetzner StorageBox (enables NATS peer discovery via shared registry)
registry:
  type: local                                # "local", "storagebox", or "none"
  # For StorageBox (enables shared registry for multi-node NATS clustering):
  # type: storagebox
  # url: https://uXXXXX.your-storagebox.de/morpheus/registry.json  # WebDAV URL for CLI access
  # storagebox_host: uXXXXX.your-storagebox.de                      # CIFS host for node mounts
  # username: uXXXXX                                                # StorageBox username
  # password: ${STORAGEBOX_PASSWORD}                                # Set via env var

# Secrets (can also be set via environment variables)
secrets:
  hetzner_api_token: ""  # Or set via HETZNER_API_TOKEN environment variable

# ─────────────────────────────────────────────────────────────────────────────
# ℹ️  Configuration Notes
# ─────────────────────────────────────────────────────────────────────────────
#
# Machine Types & Locations:
#   Morpheus automatically selects the best machine types and locations based
#   on your forest size (small/medium/large). You don't need to configure these!
#
# SSH Keys:
#   - Morpheus will automatically upload your SSH key to Hetzner if needed
#   - Default search locations: ~/.ssh/id_ed25519.pub, ~/.ssh/id_rsa.pub
#   - You can specify a custom key_path if your key is in a different location
#
# IPv6/IPv4:
#   - All machines use IPv6 by default (IPv4 costs extra on Hetzner)
#   - If your network lacks IPv6, set enable_ipv4_fallback: true
#   - Test connectivity with: morpheus check network
#   - With fallback enabled, servers get both IPv4 and IPv6 addresses
#
# API Token:
#   - Get yours at: https://console.hetzner.cloud/ → Security → API Tokens
#   - Needs "Read & Write" permissions
#   - Can be set here or via HETZNER_API_TOKEN environment variable
#
# StorageBox (for multi-node NATS clustering):
#   - NimsForest uses embedded NATS for messaging between forest nodes
#   - Nodes discover peers via shared registry mounted from StorageBox
#   - The CLI uses WebDAV (https://), nodes use CIFS mount (//host/backup)
#   - Create a StorageBox at: https://console.hetzner.cloud/ → Storage Boxes
#   - Ports used: 4222 (client), 6222 (cluster), 8222 (monitoring)
#
# Cost:
#   - small:  1 machine  ≈ €3-4/month   (perfect for testing)
#   - medium: 3 machines ≈ €9-12/month  (small production)
#   - large:  5 machines ≈ €15-20/month (larger deployment)
#   - StorageBox: €3.29/month for 1TB (optional, enables multi-node)
#   - Billed by the minute, can teardown anytime
#
# ─────────────────────────────────────────────────────────────────────────────
